{% extends "base.html" %}

{% block title %}{{ category_info.name }} - VidX{% endblock %}

{% block extra_head %}
{% if show_videos %}
<style>
    /* Hide navigation on video feed page for immersive experience */
    nav {
        display: none !important;
    }
    
    body {
        padding-top: 0 !important;
    }
    
    /* Hide desktop header and category links on video feed */
    .hidden.lg\:block {
        display: none !important;
    }
</style>
{% endif %}
{% endblock %}

{% block extra_styles %}
/* Filter Modal Styles */
#filter-modal {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateY(0);
}

.modal-header {
    position: sticky;
    top: 0;
    background: inherit;
    z-index: 10;
    padding: 1.5rem;
    border-bottom: 1px solid rgb(229, 231, 235);
}

.dark .modal-header {
    border-bottom-color: rgb(55, 65, 81);
}

.bottom-action-bar {
    position: sticky;
    bottom: 0;
    background: inherit;
    z-index: 10;
    padding: 1.5rem;
    border-top: 1px solid rgb(229, 231, 235);
}

.dark .bottom-action-bar {
    border-top-color: rgb(55, 65, 81);
}

.filter-section {
    padding: 1.5rem;
    border-bottom: 1px solid rgb(243, 244, 246);
}

.dark .filter-section {
    border-bottom-color: rgb(31, 41, 55);
}

.filter-section:last-child {
    border-bottom: none;
}

/* Scrollbar Styles */
.scroll-container {
    scrollbar-width: thin;
    scrollbar-color: #6366f1 #f1f1f1;
}
.scroll-container::-webkit-scrollbar {
    height: 6px;
}
.scroll-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}
.scroll-container::-webkit-scrollbar-thumb {
    background-color: #6366f1;
    border-radius: 10px;
}

.filter-option {
    transition: all 0.2s ease;
}
.filter-option:hover {
    background-color: rgba(99, 102, 241, 0.08);
}
.filter-option.active {
    background-color: #6366f1;
    color: #fff;
}

.video-grid {
    display: grid;
    gap: 1.5rem;
    padding: 0 1rem;
}

@media (max-width: 1023px) {
    body {
        padding: 0;
        margin: 0;
        overflow-x: hidden;
    }

    .video-grid {
        display: block;
        height: 100vh;
        height: 100dvh;
        overflow-y: scroll;
        overflow-x: hidden;
        scroll-snap-type: y mandatory;
        scroll-behavior: smooth;
        padding: 0;
        margin: 0;
        gap: 0;
        -webkit-overflow-scrolling: touch;
    }

    .video-card {
        scroll-snap-align: start;
        scroll-snap-stop: always;
        min-height: 100vh;
        min-height: 100dvh;
        height: 100vh;
        height: 100dvh;
        width: 100vw;
        max-width: 100vw;
        margin-bottom: 0 !important;
        border-radius: 0;
    }
}

@media (min-width: 1024px) {
    .video-grid {
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        justify-items: center;
        gap: 2.5rem;
        padding: 0 2rem 2.5rem;
        max-width: 1200px;
        margin: 6rem auto 0;
    }
}

.video-card {
    position: relative;
    background: #000;
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 1.5rem;
    aspect-ratio: 9 / 16;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    cursor: pointer;
}

@media (min-width: 1024px) {
    .video-card {
        margin-bottom: 0;
        width: min(100%, 360px);
        max-width: 360px;
    }
}

@media (min-width: 1440px) {
    .video-card {
        max-width: 400px;
    }
}

.video-card video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    background: #000;
    pointer-events: none;
}

.video-card video::-webkit-media-controls,
.video-card video::-webkit-media-controls-enclosure {
    display: none !important;
}

.volume-indicator {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: rgba(0, 0, 0, 0.6);
    border-radius: 9999px;
    padding: 0.5rem;
    z-index: 10;
    transition: opacity 0.3s ease;
}

.volume-indicator.fade-out {
    opacity: 0;
    pointer-events: none;
}

.video-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1.5rem;
    background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);
    z-index: 5;
    pointer-events: none;
}

@media (max-width: 1023px) {
    .video-overlay {
        padding-bottom: calc(5rem + env(safe-area-inset-bottom, 0px));
    }
}

@media (min-width: 1024px) {
    .video-overlay {
        padding-bottom: 1.5rem;
    }
}

.video-overlay > * {
    pointer-events: auto;
}

#vertical-home-btn,
#vertical-filter-btn {
    width: 36px;
    height: 48px;
}

@media (min-width: 640px) {
    #vertical-home-btn,
    #vertical-filter-btn {
        width: 44px;
        height: 100px;
        flex-direction: column;
        gap: 0.5rem;
        padding: 1rem 0.5rem;
    }

    #vertical-home-btn::after {
        content: 'HOME';
        font-size: 0.625rem;
        font-weight: 500;
        letter-spacing: 0.05em;
        writing-mode: vertical-rl;
        transform: rotate(180deg);
    }

    #vertical-filter-btn::after {
        content: 'FILTER';
        font-size: 0.625rem;
        font-weight: 500;
        letter-spacing: 0.05em;
        writing-mode: vertical-rl;
        transform: rotate(180deg);
    }
}
{% endblock %}

{% block content %}
<!-- FILTER OR VIDEO PAGE -->
{% if not show_videos %}
<!-- FILTER PAGE: Show filters first -->
<div id="filter-modal" class="min-h-screen bg-white dark:bg-dark-50 flex flex-col">
    <!-- Modal Header -->
    <div class="bg-white dark:bg-dark-100 border-b border-gray-200 dark:border-dark-300 px-4 py-4 flex items-center justify-between sticky top-0 z-10">
        <div class="flex items-center space-x-4">
            <a href="{{ url_for('home.index') }}" class="text-sm text-indigo-600 dark:text-indigo-400 font-medium hover:text-indigo-700 dark:hover:text-indigo-300 transition">
                ‚Üê Back
            </a>
            <div class="flex items-center space-x-3">
                <div class="bg-indigo-100 dark:bg-indigo-900/30 p-2 rounded-lg">
                    <i data-feather="{{ category_info.icon }}" class="h-6 w-6 text-indigo-600 dark:text-indigo-400"></i>
                </div>
                <div>
                    <h2 class="text-lg font-bold text-gray-900 dark:text-dark-600">{{ category_info.name }}</h2>
                    <p class="text-xs text-gray-500 dark:text-dark-500">Set your preferences</p>
                </div>
            </div>
        </div>
        <button id="skip-filters" class="text-sm text-indigo-600 dark:text-indigo-400 font-medium hover:text-indigo-700 dark:hover:text-indigo-300 transition">
            Skip
        </button>
    </div>

    <!-- Filter Options (Scrollable) -->
    <div class="flex-1 overflow-y-auto px-4 py-6">
        <div class="max-w-2xl mx-auto space-y-6">
            <!-- Dynamic Filters Will Be Loaded Here by JS -->
            <div id="filter-options-container" class="space-y-6">
                <!-- Filters loaded via JavaScript based on category -->
            </div>
        </div>
    </div>

    <!-- Bottom Action Bar -->
    <div class="bg-white dark:bg-dark-100 border-t border-gray-200 dark:border-dark-300 px-4 py-4 fixed bottom-16 md:bottom-0 left-0 right-0 md:sticky z-40">
        <div class="max-w-2xl mx-auto flex gap-3">
            <button id="clear-all-filters" class="flex-1 px-4 py-3 border border-gray-300 dark:border-dark-300 rounded-xl text-gray-700 dark:text-dark-500 font-medium hover:bg-gray-50 dark:hover:bg-dark-200">
                Clear All
            </button>
            <button id="apply-filters" class="flex-1 px-4 py-3 bg-indigo-600 dark:bg-indigo-500 text-white rounded-xl font-medium hover:bg-indigo-700 dark:hover:bg-indigo-600 shadow-lg">
                Show Videos
            </button>
        </div>
    </div>
</div>
{% else %}
<!-- VIDEO FEED PAGE: Show videos with applied filters -->
<div class="hidden lg:block bg-white dark:bg-dark-100 border-b border-gray-200 dark:border-dark-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="bg-indigo-100 dark:bg-indigo-900/30 p-3 rounded-lg">
                        <i data-feather="{{ category_info.icon }}" class="h-8 w-8 text-indigo-600 dark:text-indigo-400"></i>
                    </div>
                </div>
                <div class="ml-4">
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-dark-600">{{ category_info.name }}</h1>
                    <p class="text-gray-500 dark:text-dark-500">{{ category_info.description }}</p>
                </div>
            </div>
            <a href="{{ url_for('categories.category_page', category=category) }}" 
               class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-dark-300 rounded-md text-sm font-medium text-gray-700 dark:text-dark-500 bg-white dark:bg-dark-100 hover:bg-gray-50 dark:hover:bg-dark-200 transition">
                <i data-feather="sliders" class="h-4 w-4 mr-2"></i>
                Adjust Filters
            </a>
        </div>
    </div>
</div>

    </div>
</div>

<!-- Video Grid -->

<!-- Legacy Filters (Hidden - Desktop Only) -->
<div class="hidden lg:block">
    <div class="bg-white dark:bg-dark-100 shadow-sm dark:shadow-dark-200 sticky top-0 z-[100]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <div class="flex space-x-4 overflow-x-auto pb-2 scroll-container">
                <!-- Brand Filter -->
                <div class="relative">
                    <button id="brand-filter-btn" class="filter-option flex items-center px-4 py-2 border border-gray-200 dark:border-dark-200 rounded-full text-sm font-medium text-gray-700 dark:text-dark-500 hover:border-indigo-300 dark:hover:border-indigo-400">
                        <span>Brand</span>
                        <i data-feather="chevron-down" class="ml-2 h-4 w-4"></i>
                    </button>
                    <div id="brand-filter-menu" class="absolute z-[9999] mt-2 w-72 bg-white dark:bg-dark-100 rounded-md shadow-lg dark:shadow-dark-200" style="display: none;">
                        <div class="p-2">
                            <div class="px-3 py-2 sticky top-0 bg-white dark:bg-dark-100">
                                <input type="text" id="brand-search" placeholder="Search brand" class="w-full px-3 py-2 border border-gray-300 dark:border-dark-200 bg-white dark:bg-dark-100 text-gray-900 dark:text-dark-600 rounded-md">
                            </div>
                            <div class="max-h-96 overflow-y-auto" id="brand-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Category Filter -->
                <div class="relative">
                    <button id="category-filter-btn" class="filter-option flex items-center px-4 py-2 border border-gray-200 dark:border-dark-200 rounded-full text-sm font-medium text-gray-700 dark:text-dark-500 hover:border-indigo-300 dark:hover:border-indigo-400">
                        <span>Category</span>
                        <i data-feather="chevron-down" class="ml-2 h-4 w-4"></i>
                    </button>
                    <div id="category-filter-menu" class="absolute z-[9999] mt-2 w-72 bg-white dark:bg-dark-100 rounded-md shadow-lg dark:shadow-dark-200" style="display: none;">
                        <div class="p-2 max-h-96 overflow-y-auto" id="category-list"></div>
                    </div>
                </div>

                <!-- Condition Filter -->
                <div class="relative">
                    <button id="condition-filter-btn" class="filter-option flex items-center px-4 py-2 border border-gray-200 dark:border-dark-200 rounded-full text-sm font-medium text-gray-700 dark:text-dark-500 hover:border-indigo-300 dark:hover:border-indigo-400">
                        <span>Condition</span>
                        <i data-feather="chevron-down" class="ml-2 h-4 w-4"></i>
                    </button>
                    <div id="condition-filter-menu" class="absolute z-[9999] mt-2 w-64 bg-white dark:bg-dark-100 rounded-md shadow-lg dark:shadow-dark-200" style="display: none;">
                        <div class="p-2" id="condition-list"></div>
                    </div>
                </div>

                <!-- Price Filter -->
                <div class="relative">
                    <button id="price-filter-btn" class="filter-option flex items-center px-4 py-2 border border-gray-200 dark:border-dark-200 rounded-full text-sm font-medium text-gray-700 dark:text-dark-500 hover:border-indigo-300 dark:hover:border-indigo-400">
                        <span>Price</span>
                        <i data-feather="chevron-down" class="ml-2 h-4 w-4"></i>
                    </button>
                    <div id="price-filter-menu" class="absolute z-[9999] mt-2 w-64 bg-white dark:bg-dark-100 rounded-md shadow-lg dark:shadow-dark-200" style="display: none;">
                        <div class="p-4 space-y-4">
                            <div>
                                <label for="price-min" class="block text-sm text-gray-500 dark:text-dark-400">Min Price (EUR)</label>
                                <input type="number" id="price-min" class="mt-1 w-full px-3 py-2 border border-gray-300 dark:border-dark-200 bg-white dark:bg-dark-100 text-gray-900 dark:text-dark-600 rounded-md" placeholder="0">
                            </div>
                            <div>
                                <label for="price-max" class="block text-sm text-gray-500 dark:text-dark-400">Max Price (EUR)</label>
                                <input type="number" id="price-max" class="mt-1 w-full px-3 py-2 border border-gray-300 dark:border-dark-200 bg-white dark:bg-dark-100 text-gray-900 dark:text-dark-600 rounded-md" placeholder="5000">
                            </div>
                            <div class="flex justify-between">
                                <button id="price-reset" class="px-4 py-2 text-sm rounded-md border border-gray-200 dark:border-dark-200 text-gray-700 dark:text-dark-500 hover:bg-gray-100 dark:hover:bg-dark-200">Reset</button>
                                <button id="price-apply" class="px-4 py-2 text-sm rounded-md bg-indigo-600 dark:bg-indigo-500 text-white hover:bg-indigo-700 dark:hover:bg-indigo-600">Apply</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Location Filter -->
                <div class="relative">
                    <button id="location-filter-btn" class="filter-option flex items-center px-4 py-2 border border-gray-200 dark:border-dark-200 rounded-full text-sm font-medium text-gray-700 dark:text-dark-500 hover:border-indigo-300 dark:hover:border-indigo-400">
                        <span>Location</span>
                        <i data-feather="chevron-down" class="ml-2 h-4 w-4"></i>
                    </button>
                    <div id="location-filter-menu" class="absolute z-[9999] mt-2 w-72 bg-white dark:bg-dark-100 rounded-md shadow-lg dark:shadow-dark-200" style="display: none;">
                        <div class="p-2">
                            <div class="px-3 py-2 sticky top-0 bg-white dark:bg-dark-100">
                                <input type="text" id="location-search" placeholder="Search location" class="w-full px-3 py-2 border border-gray-300 dark:border-dark-200 bg-white dark:bg-dark-100 text-gray-900 dark:text-dark-600 rounded-md">
                            </div>
                            <div class="max-h-80 overflow-y-auto" id="location-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Reset Button -->
                <button id="reset-filters" class="filter-option flex items-center px-4 py-2 border border-gray-200 dark:border-dark-200 rounded-full text-sm font-medium text-gray-700 dark:text-dark-500 hover:border-indigo-300 dark:hover:border-indigo-400">
                    <span>Reset</span>
                    <i data-feather="x" class="ml-2 h-4 w-4"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Video Grid -->
<div class="video-grid" id="video-grid">
    {% if items %}
        {% for item in items %}
        <div class="video-card bg-white dark:bg-dark-100 rounded-lg overflow-hidden shadow-md dark:shadow-dark-200 hover:shadow-xl transition-shadow cursor-pointer" data-ad-id="{{ item.id }}">
            <!-- Video Container -->
            <div class="relative aspect-[9/16] bg-gray-900 group">
                <!-- Video Element -->
                <video 
                    id="video-{{ item.id }}"
                    class="w-full h-full object-cover"
                    loop
                    playsinline
                    webkit-playsinline
                    muted
                    preload="metadata"
                    poster="{{ item.thumbnail }}">
                    <source src="{{ item.video_url }}" type="video/mp4">
                </video>
                
                <!-- Play Icon Overlay -->
                <div class="absolute inset-0 flex items-center justify-center bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none play-overlay">
                    <div class="bg-white/90 rounded-full p-4 transform scale-90 group-hover:scale-100 transition-transform">
                        <i data-feather="play" class="h-8 w-8 text-indigo-600"></i>
                    </div>
                </div>
                
                <!-- Video Overlay with Info -->
                <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 via-black/40 to-transparent">
                    <!-- Title and Price -->
                    <h3 class="text-white font-semibold text-lg line-clamp-2 mb-1">{{ item.title }}</h3>
                    <p class="text-white/90 text-xl font-bold mb-2">{{ item.price }}</p>
                    
                    <!-- Meta Info -->
                    <div class="flex items-center gap-2 text-white/80 text-xs mb-3">
                        <span class="capitalize">{{ category_info.name }}</span>
                        {% if item.location %}
                        <span class="text-white/60">‚Ä¢</span>
                        <span>{{ item.location }}</span>
                        {% endif %}
                    </div>
                    
                    <!-- Engagement Stats -->
                    <div class="flex items-center gap-4 text-white/80 text-xs">
                        <div class="flex items-center gap-1">
                            <i data-feather="eye" class="h-4 w-4"></i>
                            <span>{{ item.stats.views }}</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <i data-feather="heart" class="h-4 w-4"></i>
                            <span>{{ item.stats.likes }}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Card Footer -->
            <div class="p-4">
                <!-- User Info -->
                <div class="flex items-center gap-3">
                    <img src="{{ item.user.avatar }}" alt="{{ item.user.name }}" class="h-8 w-8 rounded-full">
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-900 dark:text-dark-600 truncate">{{ item.user.name }}</p>
                        <p class="text-xs text-gray-500 dark:text-dark-400">Verified Seller</p>
                    </div>
                    <button class="favorite-btn p-2 text-gray-400 dark:text-dark-400 hover:text-red-500 dark:hover:text-red-400 transition-colors" data-ad-id="{{ item.id }}">
                        <i data-feather="heart" class="h-5 w-5"></i>
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    {% endif %}
</div>

<!-- Mobile: Floating Back Button (Video Feed Only) -->
<a href="{{ url_for('categories.category_page', category=category) }}" 
   class="fixed top-4 left-4 z-50 lg:hidden bg-white/90 dark:bg-dark-100/90 backdrop-blur-sm p-3 rounded-full shadow-lg hover:bg-white dark:hover:bg-dark-100 transition">
    <i data-feather="arrow-left" class="h-5 w-5 text-gray-900 dark:text-dark-600"></i>
</a>

<!-- No Results Message -->
<div id="no-results" class="hidden text-center py-16 px-4">
    <div class="inline-flex items-center justify-center h-16 w-16 rounded-full bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 mb-4">
        <i data-feather="search" class="h-8 w-8"></i>
    </div>
    <h3 class="text-xl font-semibold text-gray-900 dark:text-dark-600">No {{ category_info.name|lower }} match your filters</h3>
    <p class="mt-2 text-gray-500 dark:text-dark-400">Try adjusting your filters or reset them to see all listings.</p>
    <button id="no-results-reset" class="mt-6 px-4 py-2 rounded-md bg-indigo-600 dark:bg-indigo-500 text-white hover:bg-indigo-700 dark:hover:bg-indigo-600">Reset Filters</button>
</div>
{% endif %}
{% endblock %}

{% block extra_scripts %}
<!-- Seed Test Data (Development Only) -->
<script src="{{ url_for('static', filename='js/seed-test-data.js') }}"></script>

<!-- Video Card Renderer -->
<script src="{{ url_for('static', filename='js/video-card-renderer.js') }}"></script>

<!-- Video Card Engagement -->
<script src="{{ url_for('static', filename='js/video-card-engagement.js') }}"></script>

{% if show_videos %}
<!-- Load and Display Videos -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const videoGrid = document.getElementById('video-grid');
    const category = '{{ category }}';
    
    // Load published ads from localStorage
    const publishedAds = JSON.parse(localStorage.getItem('publishedAds') || '[]');
    
    // Filter by category
    const categoryAds = publishedAds.filter(ad => ad.category === category);
    
    console.log(`üìä Category: ${category}`);
    console.log(`   Total ads in storage: ${publishedAds.length}`);
    console.log(`   Ads in this category: ${categoryAds.length}`);
    
    if (categoryAds.length > 0) {
        // Use VideoCardRenderer with sound enabled for category pages
        const renderer = new VideoCardRenderer(videoGrid, {
            enableSound: true,      // Enable sound on hover
            autoplayFirst: true     // Autoplay first video with sound
        });
        renderer.addCards(categoryAds);
        
        // Replace feather icons
        if (typeof feather !== 'undefined') {
            feather.replace();
        }
        
        console.log(`‚úÖ Loaded ${categoryAds.length} video(s) for ${category} (with sound enabled)`);
    } else {
        // Show empty state
        videoGrid.innerHTML = `
            <div class="col-span-full flex flex-col items-center justify-center py-16 px-4 text-center min-h-[60vh]">
                <i data-feather="inbox" class="h-24 w-24 text-gray-400 dark:text-dark-400 mb-6"></i>
                <h3 class="text-2xl font-bold text-gray-900 dark:text-dark-600 mb-2">
                    No listings yet in {{ category_info.name }}
                </h3>
                <p class="text-gray-600 dark:text-dark-400 mb-6 max-w-md">
                    Be the first to post in this category! Upload your item and reach thousands of potential buyers.
                </p>
                <a href="{{ url_for('upload.upload_step1') }}" class="inline-flex items-center px-6 py-3 bg-indigo-600 dark:bg-indigo-500 text-white rounded-lg hover:bg-indigo-700 dark:hover:bg-indigo-600 transition font-medium">
                    <i data-feather="plus-circle" class="h-5 w-5 mr-2"></i>
                    Create First Listing
                </a>
            </div>
        `;
        if (typeof feather !== 'undefined') {
            feather.replace();
        }
    }
});
</script>
{% endif %}

<!-- iOS Safari Collapsible Navigation -->
<script>
    const isIOSSafari = /iPhone|iPad|iPod/.test(navigator.userAgent) && 
                       /Safari/.test(navigator.userAgent) && 
                       !/CriOS|FxiOS|EdgiOS/.test(navigator.userAgent);
    
    if (isIOSSafari) {
        const navBar = document.querySelector('.lg\\:hidden.fixed.bottom-0');
        
        navBar.style.border = 'none';
        navBar.style.right = '40px';
        navBar.style.transform = 'translateX(calc(100% + 40px))';
        navBar.style.transition = 'transform 0.3s ease';
        
        const toggleBtn = document.createElement('button');
        toggleBtn.id = 'nav-toggle';
        toggleBtn.className = 'fixed z-50 bg-white dark:bg-dark-100 flex items-center justify-center transition-all duration-300';
        toggleBtn.style.cssText = 'right: 0; bottom: 0; width: 40px; height: calc(64px + env(safe-area-inset-bottom)); padding-bottom: env(safe-area-inset-bottom); border: none;';
        toggleBtn.innerHTML = '<i data-feather="chevron-left" class="h-5 w-5 text-gray-700 dark:text-dark-600"></i>';
        
        let navExpanded = false;
        
        toggleBtn.addEventListener('click', () => {
            navExpanded = !navExpanded;
            
            if (navExpanded) {
                navBar.style.transform = 'translateX(0)';
                toggleBtn.querySelector('i').setAttribute('data-feather', 'chevron-right');
            } else {
                navBar.style.transform = 'translateX(calc(100% + 40px))';
                toggleBtn.querySelector('i').setAttribute('data-feather', 'chevron-left');
            }
            
            window.replaceFeatherIcons();
        });
        
        document.body.appendChild(toggleBtn);
        window.replaceFeatherIcons();
    }

    // Empty State Handler
    function checkForEmptyState() {
        const videoGrid = document.getElementById('video-grid');
        if (!videoGrid) return;
        
        const videoCards = videoGrid.querySelectorAll('.video-card');
        
        if (videoCards.length === 0) {
            videoGrid.innerHTML = `
                <div class="col-span-full flex flex-col items-center justify-center py-16 px-4 text-center">
                    <i data-feather="inbox" class="h-24 w-24 text-gray-400 dark:text-dark-400 mb-6"></i>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-dark-600 mb-2">
                        No listings yet
                    </h3>
                    <p class="text-gray-600 dark:text-dark-400 mb-6 max-w-md">
                        Be the first to post in {{ category_info.name }}! Upload your item and reach thousands of potential buyers.
                    </p>
                    <a href="{{ url_for('upload.upload_step1') }}" class="inline-flex items-center px-6 py-3 bg-indigo-600 dark:bg-indigo-500 text-white rounded-lg hover:bg-indigo-700 dark:hover:bg-indigo-600 transition font-medium">
                        <i data-feather="plus-circle" class="h-5 w-5 mr-2"></i>
                        Create First Listing
                    </a>
                </div>
            `;
            window.replaceFeatherIcons();
        }
    }

    checkForEmptyState();
</script>

{% if not show_videos %}
<!-- Filter Modal Script (loaded as regular script for iOS compatibility) -->
<script src="{{ url_for('static', filename='js/filter-modal.js') }}"></script>
{% endif %}
{% endblock %}
