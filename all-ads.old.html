<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>All Ads - VidX</title>
    <script>
        (function() {
            const storedTheme = localStorage.getItem('theme');
            if (storedTheme === 'light') {
                document.documentElement.classList.remove('dark');
            } else {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            50: '#18191A',
                            100: '#242526',
                            200: '#3A3B3C',
                            300: '#4E4F50',
                            400: '#6B6C6D',
                            500: '#B0B3B8',
                            600: '#E4E6EB',
                            700: '#F5F6F7'
                        }
                    }
                }
            }
        };
    </script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="/css/dark-mode.css">
    <script src="components/auth-modal.js"></script>
    <script src="components/user-dropdown.js"></script>
    <script src="js/video-card-engagement.js"></script>
</head>
<body class="bg-gray-50 dark:bg-dark-50 dark-mode-transition">
    <!-- Navigation -->
    <nav class="bg-white dark:bg-dark-100 shadow-sm dark:shadow-dark-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="index.html" class="flex-shrink-0 flex items-center">
                        <i data-feather="video" class="text-indigo-600 dark:text-indigo-400 h-8 w-8"></i>
                        <span class="ml-2 text-xl font-bold text-gray-900 dark:text-dark-600">VidX</span>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="#" id="desktop-favorites-link" class="hidden lg:flex items-center text-gray-700 dark:text-dark-500 hover:text-indigo-600 dark:hover:text-indigo-400 transition">
                        <i data-feather="heart" class="h-5 w-5 mr-1"></i>
                        <span class="text-sm font-medium">Favourites</span>
                    </a>
                    <a href="upload.html" class="bg-indigo-600 dark:bg-indigo-500 text-white h-7 sm:h-8 px-3 sm:px-4 rounded-full flex items-center hover:bg-indigo-700 dark:hover:bg-indigo-600 transition text-sm sm:text-base whitespace-nowrap">
                        <i data-feather="plus" class="h-4 w-4 sm:h-5 sm:w-5 mr-1 sm:mr-2"></i>
                        <span>New Ad</span>
                    </a>
                    <button id="theme-toggle" class="p-1.5 sm:p-2 rounded-full text-gray-500 dark:text-dark-500 hover:bg-gray-100 dark:hover:bg-dark-200">
                        <i data-feather="moon" class="h-5 w-5 dark:hidden"></i>
                        <i data-feather="sun" class="h-5 w-5 hidden dark:block"></i>
                    </button>
                    <button id="user-btn" class="p-1.5 sm:p-2 rounded-full text-gray-500 dark:text-dark-500 hover:bg-gray-100 dark:hover:bg-dark-200 flex items-center">
                        <img id="nav-avatar" src="" alt="" class="hidden h-6 w-6 rounded-full object-cover">
                        <i data-feather="user" id="nav-user-icon" class="h-5 w-5"></i>
                    </button>
                </div>
            </div>
        </div>
        <user-dropdown></user-dropdown>
    </nav>

    <!-- Mobile Bottom Navigation -->
    <div class="lg:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-dark-100 border-t border-gray-200 dark:border-dark-300 z-40" style="padding-bottom: env(safe-area-inset-bottom);">
        <div class="flex justify-around items-center h-16">
            <a href="index.html" class="flex flex-col items-center justify-center flex-1 py-2 text-gray-600 dark:text-dark-400 hover:text-indigo-600 dark:hover:text-indigo-400">
                <i data-feather="home" class="h-5 w-5 mb-1"></i>
                <span class="text-xs">Home</span>
            </a>
            <a href="search.html" class="flex flex-col items-center justify-center flex-1 py-2 text-gray-600 dark:text-dark-400 hover:text-indigo-600 dark:hover:text-indigo-400">
                <i data-feather="sliders" class="h-5 w-5 mb-1"></i>
                <span class="text-xs">Filters</span>
            </a>
            <a href="#" id="mobile-favorites-link" class="flex flex-col items-center justify-center flex-1 py-2 text-gray-600 dark:text-dark-400 hover:text-indigo-600 dark:hover:text-indigo-400">
                <i data-feather="heart" class="h-5 w-5 mb-1"></i>
                <span class="text-xs">Favourites</span>
            </a>
            <a href="my-ads.html" class="flex flex-col items-center justify-center flex-1 py-2 text-gray-600 dark:text-dark-400 hover:text-indigo-600 dark:hover:text-indigo-400">
                <i data-feather="list" class="h-5 w-5 mb-1"></i>
                <span class="text-xs">My Ads</span>
            </a>
            <a href="profile.html" class="flex flex-col items-center justify-center flex-1 py-2 text-gray-600 dark:text-dark-400 hover:text-indigo-600 dark:hover:text-indigo-400">
                <i data-feather="user" class="h-5 w-5 mb-1"></i>
                <span class="text-xs">Profile</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pb-24 lg:pb-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-dark-600 mb-2">All Ads</h1>
            <p class="text-gray-600 dark:text-dark-400">Browse all listings across all categories</p>
        </div>

        <!-- Category Filter Pills -->
        <div class="mb-6 flex flex-wrap gap-2">
            <button class="category-filter-btn active px-4 py-2 rounded-full text-sm font-medium transition" data-category="all">
                All Categories
            </button>
            <button class="category-filter-btn px-4 py-2 rounded-full text-sm font-medium transition" data-category="automotive">
                üöó Automotive
            </button>
            <button class="category-filter-btn px-4 py-2 rounded-full text-sm font-medium transition" data-category="real-estate">
                üè† Real Estate
            </button>
            <button class="category-filter-btn px-4 py-2 rounded-full text-sm font-medium transition" data-category="jobs">
                üíº Jobs
            </button>
            <button class="category-filter-btn px-4 py-2 rounded-full text-sm font-medium transition" data-category="services">
                üîß Services
            </button>
            <button class="category-filter-btn px-4 py-2 rounded-full text-sm font-medium transition" data-category="electronics">
                üì± Electronics
            </button>
            <button class="category-filter-btn px-4 py-2 rounded-full text-sm font-medium transition" data-category="fashion">
                üëî Fashion
            </button>
        </div>

        <!-- Ads Count -->
        <div class="mb-4">
            <p class="text-sm text-gray-600 dark:text-dark-400">
                Showing <span id="ads-count" class="font-semibold">0</span> ads
            </p>
        </div>

        <!-- Ads Grid -->
        <div id="ads-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Ads will be rendered here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-12">
            <i data-feather="inbox" class="h-16 w-16 text-gray-400 dark:text-dark-400 mx-auto mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-900 dark:text-dark-600 mb-2">No ads found</h3>
            <p class="text-gray-600 dark:text-dark-400 mb-6">Try selecting a different category</p>
        </div>
    </div>

    <style>
        .category-filter-btn {
            background-color: #f3f4f6;
            color: #4b5563;
        }
        .dark .category-filter-btn {
            background-color: #3A3B3C;
            color: #B0B3B8;
        }
        .category-filter-btn:hover {
            background-color: #e5e7eb;
        }
        .dark .category-filter-btn:hover {
            background-color: #4E4F50;
        }
        .category-filter-btn.active {
            background-color: #4f46e5;
            color: white;
        }
        .dark .category-filter-btn.active {
            background-color: #6366f1;
            color: white;
        }
    </style>

    <script>
        // Mock ad database - in production this would come from backend API
        const allAds = [
            // Automotive
            {
                id: 'vw-transporter',
                title: 'VW Transporter T6.1 2021',
                price: '‚Ç¨28,500',
                location: 'Cluj-Napoca',
                category: 'automotive',
                categoryLabel: 'Automotive',
                image: 'Demo ads/VW.m4v',
                seller: 'John Doe',
                sellerAvatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=john',
                postedDate: '2 days ago'
            },
            {
                id: 'audi-a5',
                title: 'Audi A5 Sportback 2020',
                price: '‚Ç¨38,900',
                location: 'Bucure»ôti',
                category: 'automotive',
                categoryLabel: 'Automotive',
                image: 'Demo ads/Audi.m4v',
                seller: 'Jane Smith',
                sellerAvatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=jane',
                postedDate: '5 days ago'
            }
            // Add more ads from other categories as they become available
        ];

        let currentFilter = 'all';

        // Initialize
        function init() {
            renderAds();
            setupCategoryFilters();
            setupFavoritesLinks();
            setupThemeToggle();
            setupUserMenu();
            feather.replace();
        }

        // Render ads based on current filter
        function renderAds() {
            const grid = document.getElementById('ads-grid');
            const emptyState = document.getElementById('empty-state');
            const countSpan = document.getElementById('ads-count');

            const filteredAds = currentFilter === 'all' 
                ? allAds 
                : allAds.filter(ad => ad.category === currentFilter);

            countSpan.textContent = filteredAds.length;

            if (filteredAds.length === 0) {
                grid.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');

            grid.innerHTML = filteredAds.map(ad => `
                <div class="bg-white dark:bg-dark-100 rounded-lg shadow-md overflow-hidden hover:shadow-lg transition">
                    <a href="details.html?ad=${ad.id}" class="block">
                        <div class="relative aspect-video bg-gray-200 dark:bg-dark-200">
                            <video class="w-full h-full object-cover" preload="metadata" muted playsinline>
                                <source src="${ad.image}" type="video/mp4" />
                            </video>
                            <span class="absolute top-2 left-2 bg-indigo-600 text-white text-xs px-2 py-1 rounded">
                                ${ad.categoryLabel}
                            </span>
                        </div>
                    </a>
                    <div class="p-4">
                        <div class="flex items-center mb-2">
                            <img class="h-8 w-8 rounded-full" src="${ad.sellerAvatar}" alt="${ad.seller}">
                            <div class="ml-2">
                                <h3 class="text-sm font-medium text-gray-900 dark:text-dark-600">${ad.seller}</h3>
                                <p class="text-xs text-gray-500 dark:text-dark-400">${ad.postedDate} ¬∑ ${ad.location}</p>
                            </div>
                        </div>
                        <a href="details.html?ad=${ad.id}" class="block group">
                            <h2 class="text-lg font-bold text-gray-900 dark:text-dark-600 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition mb-1">
                                ${ad.title}
                            </h2>
                        </a>
                        <div class="flex items-center justify-between mt-3">
                            <span class="text-xl font-bold text-indigo-600 dark:text-indigo-400">${ad.price}</span>
                            <div class="flex space-x-2">
                                <button data-favorite-btn data-ad-id="${ad.id}" data-favorite-count="0" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-200 rounded-full transition">
                                    <i data-feather="heart" class="h-5 w-5 text-gray-600 dark:text-dark-400"></i>
                                </button>
                                <button data-share-btn data-ad-id="${ad.id}" data-ad-title="${ad.title}" data-ad-price="${ad.price}" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-200 rounded-full transition">
                                    <i data-feather="share-2" class="h-5 w-5 text-gray-600 dark:text-dark-400"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            feather.replace();
            
            // Reinitialize engagement buttons
            if (window.videoCardEngagement) {
                window.videoCardEngagement.refreshButtonStates();
            }
        }

        // Setup category filter buttons
        function setupCategoryFilters() {
            const filterBtns = document.querySelectorAll('.category-filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active class from all buttons
                    filterBtns.forEach(b => b.classList.remove('active'));
                    // Add active class to clicked button
                    btn.classList.add('active');
                    // Update filter and re-render
                    currentFilter = btn.dataset.category;
                    renderAds();
                });
            });
        }

        // Setup favorites links
        function setupFavoritesLinks() {
            const desktopLink = document.getElementById('desktop-favorites-link');
            const mobileLink = document.getElementById('mobile-favorites-link');

            [desktopLink, mobileLink].forEach(link => {
                if (link) {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const isLoggedIn = localStorage.getItem('authToken') || localStorage.getItem('sessionToken');
                        if (isLoggedIn) {
                            window.location.href = 'favourites.html';
                        } else {
                            window.location.href = 'index.html#register';
                        }
                    });
                }
            });
        }

        // Theme toggle
        function setupThemeToggle() {
            document.getElementById('theme-toggle').addEventListener('click', function() {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.theme = isDark ? 'dark' : 'light';
                feather.replace();
            });
        }

        // User menu
        function setupUserMenu() {
            const userBtn = document.getElementById('user-btn');
            const userDropdown = document.querySelector('user-dropdown');
            
            if (userBtn && userDropdown) {
                userBtn.addEventListener('click', () => {
                    userDropdown.toggleDropdown();
                });
            }
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
