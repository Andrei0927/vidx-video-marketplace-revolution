<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review & Publish - VidX</title>
    <script>
        (function() {
            const storedTheme = localStorage.getItem('theme');
            if (storedTheme === 'light') {
                document.documentElement.classList.remove('dark');
            } else {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            50: '#18191A',
                            100: '#242526',
                            200: '#3A3B3C',
                            300: '#4E4F50',
                            400: '#6B6C6D',
                            500: '#B0B3B8',
                            600: '#E4E6EB',
                            700: '#F5F6F7'
                        }
                    }
                }
            }
        };
    </script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="/css/dark-mode.css">
</head>
<body class="bg-gray-50 dark:bg-dark-50 dark-mode-transition">
    <!-- Navigation -->
    <nav class="bg-white dark:bg-dark-100 shadow-sm dark:shadow-dark-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="index.html" class="flex-shrink-0 flex items-center">
                        <i data-feather="video" class="text-indigo-600 dark:text-indigo-400 h-8 w-8"></i>
                        <span class="ml-2 text-xl font-bold text-gray-900 dark:text-dark-600">VidX</span>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="upload-details.html" class="text-gray-700 dark:text-dark-500 hover:text-indigo-600 dark:hover:text-indigo-400 transition flex items-center">
                        <i data-feather="arrow-left" class="h-5 w-5 mr-2"></i>
                        <span>Back</span>
                    </a>
                    <button id="theme-toggle" class="p-1.5 sm:p-2 rounded-full text-gray-500 dark:text-dark-500 hover:bg-gray-100 dark:hover:bg-dark-200">
                        <i data-feather="moon" class="h-5 w-5 dark:hidden"></i>
                        <i data-feather="sun" class="h-5 w-5 hidden dark:block"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Review Form -->
    <div class="max-w-3xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <div class="bg-white dark:bg-dark-100 shadow dark:shadow-dark-200 rounded-lg overflow-hidden">
            <!-- Progress Stepper -->
            <div class="px-6 py-4 border-b border-gray-200 dark:border-dark-200">
                <div class="flex items-center justify-between">
                    <div class="flex items-center opacity-50">
                        <div class="flex-shrink-0 bg-green-600 dark:bg-green-500 rounded-full h-8 w-8 flex items-center justify-center">
                            <i data-feather="check" class="h-5 w-5 text-white"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-900 dark:text-dark-600">Upload Media</h3>
                        </div>
                    </div>
                    <div class="flex items-center opacity-50">
                        <div class="flex-shrink-0 bg-green-600 dark:bg-green-500 rounded-full h-8 w-8 flex items-center justify-center">
                            <i data-feather="check" class="h-5 w-5 text-white"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-900 dark:text-dark-600">Add Details</h3>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="flex-shrink-0 bg-indigo-600 dark:bg-indigo-500 rounded-full h-8 w-8 flex items-center justify-center">
                            <span class="text-white font-medium">3</span>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-lg font-medium text-gray-900 dark:text-dark-600">Review & Publish</h3>
                            <p class="text-sm text-gray-500 dark:text-dark-400">Confirm and submit</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Review Content -->
            <div id="review-content" class="px-6 py-8 space-y-6">
                <!-- Loading state -->
                <div class="text-center py-8">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
                    <p class="mt-4 text-gray-500 dark:text-dark-400">Loading your ad details...</p>
                </div>
            </div>

            <!-- Publishing Progress (hidden initially) -->
            <div id="publishing-progress" class="hidden px-6 py-8">
                <div class="bg-indigo-50 dark:bg-dark-200 border border-indigo-200 dark:border-dark-300 rounded-lg p-6">
                    <div class="flex items-center">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                        <div class="ml-4">
                            <h3 class="text-lg font-medium text-indigo-900 dark:text-indigo-300">Creating your AI video...</h3>
                            <p class="text-sm text-indigo-700 dark:text-indigo-400 mt-1">This may take 1-2 minutes</p>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="flex justify-between text-sm text-indigo-700 dark:text-indigo-400 mb-1">
                            <span id="progress-label">Uploading images...</span>
                            <span id="progress-percent">0%</span>
                        </div>
                        <div class="w-full bg-indigo-200 dark:bg-dark-300 rounded-full h-2">
                            <div id="progress-bar" class="bg-indigo-600 dark:bg-indigo-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="mt-4 space-y-2">
                        <div id="step-1" class="flex items-center text-sm text-gray-600 dark:text-dark-400">
                            <i data-feather="loader" class="h-4 w-4 mr-2 animate-spin"></i>
                            <span>Processing images...</span>
                        </div>
                        <div id="step-2" class="hidden flex items-center text-sm text-gray-600 dark:text-dark-400">
                            <i data-feather="loader" class="h-4 w-4 mr-2 animate-spin"></i>
                            <span>Generating voiceover from description...</span>
                        </div>
                        <div id="step-3" class="hidden flex items-center text-sm text-gray-600 dark:text-dark-400">
                            <i data-feather="loader" class="h-4 w-4 mr-2 animate-spin"></i>
                            <span>Creating video with transitions and effects...</span>
                        </div>
                        <div id="step-4" class="hidden flex items-center text-sm text-gray-600 dark:text-dark-400">
                            <i data-feather="loader" class="h-4 w-4 mr-2 animate-spin"></i>
                            <span>Adding captions...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div id="nav-buttons" class="px-6 py-4 bg-gray-50 dark:bg-dark-50 flex justify-between border-t border-gray-200 dark:border-dark-200">
                <button onclick="window.location.href='upload-details.html'" class="px-4 py-2 border border-gray-300 dark:border-dark-200 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-dark-500 bg-white dark:bg-dark-100 hover:bg-gray-50 dark:hover:bg-dark-200">
                    Back
                </button>
                <button id="publish-btn" class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 dark:bg-indigo-500 hover:bg-indigo-700 dark:hover:bg-indigo-600 flex items-center">
                    <i data-feather="send" class="h-4 w-4 mr-2"></i>
                    Publish Ad
                </button>
            </div>
        </div>
    </div>

    <script>
        feather.replace();

        // Theme toggle
        const themeToggle = document.getElementById('theme-toggle');
        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.theme = isDark ? 'dark' : 'light';
            feather.replace();
        });

        // Load data from previous steps
        let adData = null;
        let uploadFiles = null;

        try {
            adData = JSON.parse(sessionStorage.getItem('adDetails') || '{}');
            uploadFiles = JSON.parse(sessionStorage.getItem('uploadFiles') || '[]');
            displayReview();
        } catch (err) {
            console.error('Error loading data:', err);
            document.getElementById('review-content').innerHTML = `
                <div class="text-center py-8">
                    <i data-feather="alert-circle" class="h-16 w-16 text-red-500 mx-auto mb-4"></i>
                    <h3 class="text-lg font-medium text-gray-900 dark:text-dark-600 mb-2">No ad data found</h3>
                    <p class="text-gray-500 dark:text-dark-400 mb-4">Please start from the beginning</p>
                    <a href="upload.html" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700">
                        Start Upload
                    </a>
                </div>
            `;
            feather.replace();
        }

        function displayReview() {
            if (!adData || !adData.title) {
                return;
            }

            const reviewContent = document.getElementById('review-content');
            reviewContent.innerHTML = `
                <div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-dark-600 mb-6">Review Your Ad</h2>
                    
                    <!-- Preview -->
                    <div class="bg-gray-50 dark:bg-dark-50 rounded-lg p-6 mb-6">
                        <h3 class="text-lg font-medium text-gray-900 dark:text-dark-600 mb-4">Preview</h3>
                        <div class="grid grid-cols-4 gap-2 mb-4">
                            ${uploadFiles.slice(0, 4).map((file, i) => `
                                <img src="${file.data}" class="w-full aspect-square object-cover rounded ${i === 0 ? 'ring-2 ring-indigo-600' : ''}" alt="Image ${i+1}">
                            `).join('')}
                        </div>
                        ${uploadFiles.length > 4 ? `<p class="text-sm text-gray-500 dark:text-dark-400">+${uploadFiles.length - 4} more image(s)</p>` : ''}
                    </div>

                    <!-- Details -->
                    <div class="space-y-4">
                        <div>
                            <h3 class="text-sm font-medium text-gray-500 dark:text-dark-400">Title</h3>
                            <p class="mt-1 text-lg font-medium text-gray-900 dark:text-dark-600">${adData.title}</p>
                        </div>
                        
                        <div>
                            <h3 class="text-sm font-medium text-gray-500 dark:text-dark-400">Category</h3>
                            <p class="mt-1 text-gray-900 dark:text-dark-600 capitalize">${adData.category}</p>
                        </div>

                        <div>
                            <h3 class="text-sm font-medium text-gray-500 dark:text-dark-400">Price</h3>
                            <p class="mt-1 text-xl font-bold text-indigo-600 dark:text-indigo-400">â‚¬${parseFloat(adData.price).toLocaleString()}</p>
                        </div>

                        <div>
                            <h3 class="text-sm font-medium text-gray-500 dark:text-dark-400">Location</h3>
                            <p class="mt-1 text-gray-900 dark:text-dark-600">${adData.location}</p>
                        </div>

                        <div>
                            <h3 class="text-sm font-medium text-gray-500 dark:text-dark-400">Description (for AI voiceover)</h3>
                            <p class="mt-1 text-gray-900 dark:text-dark-600 whitespace-pre-line">${adData.description}</p>
                        </div>

                        ${adData.category === 'automotive' && adData.make ? `
                        <div class="border-t border-gray-200 dark:border-dark-200 pt-4">
                            <h3 class="text-sm font-medium text-gray-500 dark:text-dark-400 mb-3">Vehicle Details</h3>
                            <dl class="grid grid-cols-2 gap-4">
                                ${adData.make ? `<div><dt class="text-sm text-gray-500 dark:text-dark-400">Make</dt><dd class="text-gray-900 dark:text-dark-600">${adData.make}</dd></div>` : ''}
                                ${adData.model ? `<div><dt class="text-sm text-gray-500 dark:text-dark-400">Model</dt><dd class="text-gray-900 dark:text-dark-600">${adData.model}</dd></div>` : ''}
                                ${adData.year ? `<div><dt class="text-sm text-gray-500 dark:text-dark-400">Year</dt><dd class="text-gray-900 dark:text-dark-600">${adData.year}</dd></div>` : ''}
                                ${adData.mileage ? `<div><dt class="text-sm text-gray-500 dark:text-dark-400">Mileage</dt><dd class="text-gray-900 dark:text-dark-600">${adData.mileage}</dd></div>` : ''}
                                ${adData.transmission ? `<div><dt class="text-sm text-gray-500 dark:text-dark-400">Transmission</dt><dd class="text-gray-900 dark:text-dark-600">${adData.transmission}</dd></div>` : ''}
                                ${adData.fuel ? `<div><dt class="text-sm text-gray-500 dark:text-dark-400">Fuel</dt><dd class="text-gray-900 dark:text-dark-600">${adData.fuel}</dd></div>` : ''}
                            </dl>
                        </div>
                        ` : ''}
                    </div>

                    <!-- AI Info -->
                    <div class="mt-6 bg-indigo-50 dark:bg-dark-200 border border-indigo-200 dark:border-dark-300 rounded-lg p-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i data-feather="zap" class="h-5 w-5 text-indigo-600 dark:text-indigo-400"></i>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-indigo-800 dark:text-indigo-300">AI Video Generation</h3>
                                <div class="mt-2 text-sm text-indigo-700 dark:text-indigo-400">
                                    <p><strong>Style:</strong> ${adData.style || 'Modern Slideshow'}</p>
                                    <p><strong>Music:</strong> ${adData.music || 'Upbeat'}</p>
                                    <p class="mt-2">When you publish, Revid.ai will create a professional video with AI-generated voiceover and captions based on your description.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            feather.replace();
        }

        // Publish button handler
        document.getElementById('publish-btn').addEventListener('click', async () => {
            const publishBtn = document.getElementById('publish-btn');
            const navButtons = document.getElementById('nav-buttons');
            const reviewContent = document.getElementById('review-content');
            const publishingProgress = document.getElementById('publishing-progress');

            // Hide review, show progress
            reviewContent.classList.add('hidden');
            publishingProgress.classList.remove('hidden');
            publishBtn.disabled = true;

            // Simulate AI video generation process
            const steps = [
                { label: 'Uploading images...', percent: 20, stepId: 'step-1' },
                { label: 'Generating voiceover...', percent: 40, stepId: 'step-2' },
                { label: 'Creating video...', percent: 70, stepId: 'step-3' },
                { label: 'Adding captions...', percent: 90, stepId: 'step-4' },
                { label: 'Finalizing...', percent: 100, stepId: null }
            ];

            for (let i = 0; i < steps.length; i++) {
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                const step = steps[i];
                document.getElementById('progress-label').textContent = step.label;
                document.getElementById('progress-percent').textContent = step.percent + '%';
                document.getElementById('progress-bar').style.width = step.percent + '%';

                if (step.stepId) {
                    // Mark previous step complete
                    if (i > 0 && steps[i-1].stepId) {
                        const prevStep = document.getElementById(steps[i-1].stepId);
                        prevStep.innerHTML = '<i data-feather="check-circle" class="h-4 w-4 mr-2 text-green-600"></i><span class="text-green-600">Complete</span>';
                        feather.replace();
                    }
                    // Show current step
                    document.getElementById(step.stepId).classList.remove('hidden');
                }
            }

            // Mark last step complete
            const lastStep = document.getElementById('step-4');
            lastStep.innerHTML = '<i data-feather="check-circle" class="h-4 w-4 mr-2 text-green-600"></i><span class="text-green-600">Complete</span>';
            feather.replace();

            // Show success and redirect
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            publishingProgress.innerHTML = `
                <div class="bg-green-50 dark:bg-dark-200 border border-green-200 dark:border-dark-300 rounded-lg p-6 text-center">
                    <i data-feather="check-circle" class="h-16 w-16 text-green-600 dark:text-green-400 mx-auto mb-4"></i>
                    <h3 class="text-2xl font-bold text-green-900 dark:text-green-300 mb-2">Ad Published Successfully!</h3>
                    <p class="text-green-700 dark:text-green-400 mb-4">Your video ad is now live on the marketplace</p>
                    <p class="text-sm text-gray-600 dark:text-dark-400 mb-6">Redirecting to your ad...</p>
                </div>
            `;
            feather.replace();

            // Clear session storage
            sessionStorage.removeItem('uploadData');
            sessionStorage.removeItem('uploadFiles');
            sessionStorage.removeItem('adDetails');

            // Redirect to automotive page after 2 seconds
            setTimeout(() => {
                window.location.href = adData.category === 'automotive' ? 'automotive.html' : 'electronics.html';
            }, 2000);
        });
    </script>
</body>
</html>
