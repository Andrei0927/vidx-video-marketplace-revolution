<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filter Renderer Example - vidx</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="bg-gray-50 dark:bg-dark-100">
    
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-dark-600 mb-2">Dynamic Filter Renderer Demo</h1>
            <p class="text-gray-600 dark:text-dark-400">Select a category to see its filters rendered dynamically</p>
        </header>

        <!-- Category Selector -->
        <div class="mb-6">
            <label class="block font-medium text-gray-900 dark:text-dark-600 mb-3">Select Category Schema:</label>
            <div class="flex space-x-4">
                <button id="btn-automotive" class="category-btn px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-medium">
                    <i data-feather="truck" class="inline h-4 w-4 mr-2"></i>Automotive
                </button>
                <button id="btn-electronics" class="category-btn px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition font-medium">
                    <i data-feather="smartphone" class="inline h-4 w-4 mr-2"></i>Electronics
                </button>
                <button id="btn-fashion" class="category-btn px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition font-medium">
                    <i data-feather="shopping-bag" class="inline h-4 w-4 mr-2"></i>Fashion
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Filters Column -->
            <div class="lg:col-span-1">
                <div class="bg-white dark:bg-dark-200 rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-dark-600 mb-4">Filters</h2>
                    
                    <!-- Dynamic Filter Container -->
                    <div id="filter-container" class="space-y-4"></div>
                </div>
            </div>

            <!-- Results Column -->
            <div class="lg:col-span-2">
                <div class="bg-white dark:bg-dark-200 rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-dark-600 mb-4">Active Filters</h2>
                    
                    <!-- Active Filter Display -->
                    <div id="active-filters" class="mb-6">
                        <p class="text-gray-500 dark:text-dark-400 italic">No filters applied</p>
                    </div>

                    <hr class="my-6 border-gray-200 dark:border-dark-300">

                    <h2 class="text-xl font-bold text-gray-900 dark:text-dark-600 mb-4">Filter JSON Output</h2>
                    
                    <!-- JSON Output -->
                    <pre id="json-output" class="bg-gray-100 dark:bg-dark-100 p-4 rounded-lg text-sm overflow-x-auto"><code>{}</code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/automotive-filter-schema.js"></script>
    <script src="js/electronics-filter-schema.js"></script>
    <script src="js/fashion-filter-schema.js"></script>
    <script src="js/filter-renderer.js"></script>
    
    <script>
        let currentRenderer = null;
        let currentCategory = 'automotive';

        // Initialize with Automotive
        function loadFilters(category) {
            let schema, modelsData = null;
            
            switch(category) {
                case 'automotive':
                    schema = automotiveFilterSchema;
                    modelsData = carModels; // Pass car models for make-model dependency
                    break;
                case 'electronics':
                    schema = electronicsFilterSchema;
                    break;
                case 'fashion':
                    schema = fashionFilterSchema;
                    break;
                default:
                    schema = automotiveFilterSchema;
                    modelsData = carModels;
            }

            // Create new renderer with car models if automotive
            currentRenderer = new FilterRenderer(schema, 'filter-container', { 
                carModels: modelsData 
            });
            
            // Set up callbacks
            currentRenderer.on('onChange', (filters) => {
                updateActiveFilters(filters);
            });

            currentRenderer.on('onApply', (filters) => {
                console.log('Filters applied:', filters);
                updateActiveFilters(filters);
                alert('Filters applied! Check console for details.');
            });

            currentRenderer.on('onClear', () => {
                console.log('Filters cleared');
                updateActiveFilters({});
            });

            // Render the filters
            currentRenderer.render();
            
            // Replace feather icons
            window.replaceFeatherIcons();
            
            currentCategory = category;
        }

        // Update active filters display
        function updateActiveFilters(filters) {
            const container = document.getElementById('active-filters');
            const jsonOutput = document.getElementById('json-output');
            
            // Update JSON output
            jsonOutput.querySelector('code').textContent = JSON.stringify(filters, null, 2);
            
            // Update active filters display
            if (Object.keys(filters).length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-dark-400 italic">No filters applied</p>';
                return;
            }

            let html = '<div class="flex flex-wrap gap-2">';
            
            Object.entries(filters).forEach(([key, value]) => {
                if (Array.isArray(value)) {
                    value.forEach(v => {
                        html += `
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-200">
                                ${key}: ${v}
                                <button class="ml-2 hover:text-indigo-600" onclick="removeFilter('${key}', '${v}')">
                                    <i data-feather="x" class="h-3 w-3"></i>
                                </button>
                            </span>
                        `;
                    });
                } else {
                    html += `
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-indigo-100 dark:bg-indigo-900 text-indigo-800 dark:text-indigo-200">
                            ${key}: ${value}
                            <button class="ml-2 hover:text-indigo-600" onclick="removeFilter('${key}')">
                                <i data-feather="x" class="h-3 w-3"></i>
                            </button>
                        </span>
                    `;
                }
            });
            
            html += '</div>';
            container.innerHTML = html;
            window.replaceFeatherIcons();
        }

        // Remove individual filter
        function removeFilter(key, value) {
            // This would need to interact with the renderer to actually remove the filter
            console.log('Remove filter:', key, value);
        }

        // Category button handlers
        document.getElementById('btn-automotive').addEventListener('click', function() {
            loadFilters('automotive');
            updateCategoryButtons('btn-automotive');
        });

        document.getElementById('btn-electronics').addEventListener('click', function() {
            loadFilters('electronics');
            updateCategoryButtons('btn-electronics');
        });

        document.getElementById('btn-fashion').addEventListener('click', function() {
            loadFilters('fashion');
            updateCategoryButtons('btn-fashion');
        });

        // Update category button states
        function updateCategoryButtons(activeId) {
            document.querySelectorAll('.category-btn').forEach(btn => {
                if (btn.id === activeId) {
                    btn.className = 'category-btn px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-medium';
                } else {
                    btn.className = 'category-btn px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition font-medium';
                }
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadFilters('automotive');
            window.replaceFeatherIcons();
        });
    </script>
</body>
</html>
