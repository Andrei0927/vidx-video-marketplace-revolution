<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Debug - VidX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .console-log {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 4px 8px;
            border-left: 3px solid #3b82f6;
            background: #f1f5f9;
            margin: 4px 0;
        }
        .console-error {
            border-left-color: #ef4444;
            background: #fee2e2;
        }
        .console-warn {
            border-left-color: #f59e0b;
            background: #fef3c7;
        }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">Auth Modal Debug Tool</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Current Auth State</h2>
                <div id="auth-state" class="space-y-2 text-sm">
                    <div><strong>Session Token:</strong> <span id="session-token" class="font-mono text-xs bg-gray-100 p-1"></span></div>
                    <div><strong>User Name:</strong> <span id="user-name"></span></div>
                    <div><strong>User Email:</strong> <span id="user-email"></span></div>
                    <div><strong>User ID:</strong> <span id="user-id"></span></div>
                </div>
                <button onclick="refreshAuthState()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    Refresh State
                </button>
                <button onclick="clearAuthState()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                    Clear Auth
                </button>
            </div>

            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Actions</h2>
                <div class="space-y-3">
                    <button onclick="showAuthModal()" class="w-full px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">
                        Show Auth Modal
                    </button>
                    <button onclick="testCustomElement()" class="w-full px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                        Test Custom Element
                    </button>
                    <button onclick="testAuthService()" class="w-full px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">
                        Test Auth Service
                    </button>
                    <button onclick="clearConsole()" class="w-full px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">
                        Clear Console
                    </button>
                </div>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Console Output (Preserved)</h2>
            <div id="console-output" class="space-y-1 max-h-96 overflow-y-auto"></div>
        </div>
    </div>

    <script type="module" src="components/auth-modal.js"></script>
    <script type="module">
        // Import auth service
        import AuthService from './js/auth-service.js';
        window.AuthService = AuthService;

        // Override console methods to capture output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function addToConsole(message, type = 'log') {
            const consoleOutput = document.getElementById('console-output');
            const entry = document.createElement('div');
            entry.className = `console-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleOutput.appendChild(entry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole(args.join(' '), 'warn');
        };

        // Global functions
        window.refreshAuthState = function() {
            document.getElementById('session-token').textContent = localStorage.getItem('sessionToken') || 'None';
            document.getElementById('user-name').textContent = localStorage.getItem('userName') || 'None';
            document.getElementById('user-email').textContent = localStorage.getItem('userEmail') || 'None';
            document.getElementById('user-id').textContent = localStorage.getItem('userId') || 'None';
            console.log('Auth state refreshed');
        };

        window.clearAuthState = function() {
            localStorage.removeItem('sessionToken');
            localStorage.removeItem('authToken');
            localStorage.removeItem('userName');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userId');
            localStorage.removeItem('userAvatar');
            refreshAuthState();
            console.log('Auth state cleared');
        };

        window.showAuthModal = function() {
            console.log('Creating auth-modal element...');
            try {
                const modal = document.createElement('auth-modal');
                console.log('Auth modal created:', modal);
                modal.setAttribute('default-tab', 'login');
                console.log('Default tab set to login');
                document.body.appendChild(modal);
                console.log('Auth modal appended to body');

                // Listen for close event
                modal.addEventListener('close', () => {
                    console.log('Auth modal closed');
                    refreshAuthState();
                });
            } catch (error) {
                console.error('Error creating auth modal:', error);
            }
        };

        window.testCustomElement = function() {
            console.log('Testing custom element registration...');
            const isDefined = customElements.get('auth-modal');
            if (isDefined) {
                console.log('✅ auth-modal is registered');
                console.log('Definition:', isDefined);
            } else {
                console.error('❌ auth-modal is NOT registered');
            }
        };

        window.testAuthService = function() {
            console.log('Testing auth service...');
            try {
                const service = new window.AuthService();
                console.log('✅ Auth service instantiated:', service);
                console.log('Base URL:', service.baseUrl);
                console.log('Is logged in:', service.isLoggedIn());
            } catch (error) {
                console.error('❌ Error with auth service:', error);
            }
        };

        window.clearConsole = function() {
            document.getElementById('console-output').innerHTML = '';
        };

        // Initialize
        console.log('Debug page loaded');
        refreshAuthState();
        
        // Check if custom element is defined after a delay
        setTimeout(() => {
            testCustomElement();
        }, 500);
    </script>
</body>
</html>
